<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>FlensSabers ‚Äì Mitgliederbereich</title>
<meta content="noindex,nofollow" name="robots"/>
<link href="images/logo.png" rel="icon"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&amp;family=Oswald:wght@500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="styles.css" rel="stylesheet"/>

<!-- FullCalendar (Calendar UI) -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet"/>

<style>
.dark-side {
    color: #000;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 2px;
    padding: 4px 12px;
    border-radius: 8px;
    background: linear-gradient(145deg, #000000, #1a1a1a);
    box-shadow: 
        0 0 15px rgba(0,0,0,0.8),
        0 0 30px rgba(255,0,0,0.4);
    text-shadow: 
        0 0 5px rgba(255,0,0,0.7),
        0 0 15px rgba(255,0,0,0.6);
}
</style>

</head>
<body>
<script>
  // Basic protection: members.html should only be reachable after login on index.html
  (function(){
    try{
      if(sessionStorage.getItem('fs_member') !== '1'){
        window.location.replace('index.html');
      }
    }catch(_){
      // If storage is blocked, still allow access.
    }
  })();
</script>
<div class="bg">
<div aria-hidden="true" class="bg__image"></div>
<div aria-hidden="true" class="bg__vignette"></div>
<div aria-hidden="true" class="bg__grain"></div>
<div aria-hidden="true" class="bg__sweep"></div>
</div>
<header class="topbar">
<div class="topbar__inner">
<a aria-label="Zur√ºck zur Startseite" class="brand" href="index.html">
<img alt="FlensSabers Logo" class="brand__logo" src="images/logo.png"/>
<span class="brand__text">FlensSabers</span>
</a>
<nav class="nav">
<a href="index.html#training">Training</a>
<a href="index.html#join">Mitmachen</a>
<a class="nav__ig" href="https://www.instagram.com/flenssabers/" rel="noreferrer noopener" target="_blank">Instagram</a>
</nav>
</div>
</header>
<main class="wrap" id="top">
<section class="member-hero">
<div class="kicker">Mitgliederbereich ‚Ä¢ FlensSabers</div>
<h1 class="member-hero__title">Willkommen auf der <span class="dark-side">Dunklen Seite</span> FlensSabers Mitglied!</h1>
<p class="member-hero__sub">
        Hier kannst du bald intern alles Wichtige finden ‚Äì und schon jetzt Merch bestellen.<br>
        <strong>Die ersten Produkte sind ONLINE!</strong> 
      </p>
<div class="cta" style="margin-top:14px;">
<a class="btn btn--ghost" href="index.html">‚Üê Zur√ºck zur Homepage</a>
<a class="btn btn--primary" href="#shop">üõí Zum Merch</a>
</div>
</section>

<!-- Events / Kalender -->
<section class="section" id="events">
  <div class="section__head">
    <h2>Kalender ‚Äì Bevorstehende Events</h2>
    <p>√úbersicht √ºber unsere n√§chsten Auftritte, Termine &amp; Events.</p>
  </div>

  <div class="events-wrap">
    <div class="events-cal">
      <div id="fsCalendar"></div>
    </div>

    <aside class="events-side" aria-label="N√§chste Termine">
      <div class="events-upcoming">
        <h3>N√§chste Termine</h3>
        <div id="upcomingList" class="events-upcoming__list"></div>
      </div>

    </aside>
  </div>
</section>
<section class="section" id="shop">
<div class="section__head">
<h2>FlensSabers Merch</h2>
<p>W√§hle deine Artikel ‚Äì wir erstellen daraus eine Bestell‚ÄëE‚ÄëMail.</p>
</div>
<div class="shop">
<div>
<div class="shop-grid" id="shopGrid"></div>
</div>
<aside aria-label="Warenkorb" class="cart">
<h3>Warenkorb</h3>
<p class="cart__empty" id="cartEmpty">Noch leer ‚Äì f√ºge links Produkte hinzu.</p>
<ul class="cart__list" id="cartList"></ul>
<div class="cart__row">
<button class="btn btn--primary" id="sendOrder" type="button">Bestellung senden</button>
<button class="btn btn--ghost" id="clearCart" type="button">Leeren</button>
</div>


<form autocomplete="on" class="orderform" id="orderForm" style="margin-top:14px;">
<div class="field">
<label for="buyerFirst">Vorname</label>
<input id="buyerFirst" name="buyerFirst" placeholder="z.B. Max" required="" type="text"/>
</div>
<div class="field">
<label for="buyerLast">Nachname</label>
<input id="buyerLast" name="buyerLast" placeholder="z.B. Mustermann" required="" type="text"/>
</div>
<div class="field">
<label for="buyerEmail">E-Mail</label>
<input id="buyerEmail" name="buyerEmail" placeholder="name@domain.de" required="" type="email"/>
</div>
<div class="field">
<label for="buyerCode">Passcode</label>
<input id="buyerCode" name="buyerCode" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required="" type="password"/>
</div>
<p class="fineprint" style="margin:10px 0 0;">
    Die Bezahlung der Artikel erfolgt bei Abholung.
  </p>
</form>
</aside>
</div>
</section>
<footer class="footer">
<div class="footer__inner">
<a href="https://www.instagram.com/flenssabers/" rel="noreferrer noopener" target="_blank">Instagram</a>
<a class="psv-badge" href="https://www.psv-flensburg.de/" rel="noreferrer noopener" target="_blank">
<img alt="PSV Logo" class="psv-badge__logo" src="images/psv.png"/>
<span class="psv-badge__text">Mitglied des Sportvereins</span>
</a>
<span>¬© <span id="y"></span> FlensSabers</span>
</div>
</footer>
</main>
<!-- Gate (also protects direct access to members.html) -->

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script>
  // Footer year
  document.getElementById('y').textContent = new Date().getFullYear();

  // EmailJS config
  const EMAILJS_PUBLIC_KEY  = "4CnavaqKWFWhNVTIm";
  const EMAILJS_SERVICE_ID  = "service_dy86jgf";
  const EMAILJS_TEMPLATE_ID = "template_rb3ufnr";

  // Init EmailJS (loaded via CDN script tag above)
  try { emailjs.init(EMAILJS_PUBLIC_KEY); } catch (e) { console.warn("EmailJS init failed", e); }

  // --- Simple merch placeholders + cart -> EmailJS ---
  (function () {
    const PRODUCTS = [
      { id: 'tee',     name: 'FlensSabers T-Shirt',           meta: 'Black ‚Ä¢ Unisex ‚Ä¢',  price: '22,00 ‚Ç¨', images: ['images/shop/tee-front.png', 'images/shop/tee-back.png'] },
      { id: 'hoodie',  name: 'FlensSabers Kapuzen Hoodie',    meta: 'Black ‚Ä¢ Unisex ‚Ä¢', price: '28,00 ‚Ç¨', images: ['images/shop/khoodie-front.png', 'images/shop/khoodie-back.png'] },
      { id: 'pullover',name: 'FlensSabers Pullover',          meta: 'Black ‚Ä¢ Unisex ‚Ä¢', price: '26,00 ‚Ç¨', images: ['images/shop/pl-front.png', 'images/shop/pl-back.png'] },
      { id: 'polo',    name: 'FlensSabers Poloshirt',         meta: 'Black ‚Ä¢ Unisex ‚Ä¢',  price: '24,00 ‚Ç¨', images: ['images/shop/polo-front.png', 'images/shop/polo-back.png'] },
      { id: 'jacket',  name: 'FlensSabers Jacke',             meta: 'Black ‚Ä¢ Unisex ‚Ä¢', price: '29,00 ‚Ç¨', images: ['images/shop/jk-front.png', 'images/shop/jk-back.png'] },
            { id: 'Cap',  name: 'FlensSabers Cap',            meta: 'Black ‚Ä¢ Unisex ‚Ä¢', price: '24,00 ‚Ç¨', images: ['images/shop/cap-front.png'] },
    ];

    const grid      = document.getElementById('shopGrid');
    const cartEmpty = document.getElementById('cartEmpty');
    const cartList  = document.getElementById('cartList');
    const sendBtn   = document.getElementById('sendOrder');
    const clearBtn  = document.getElementById('clearCart');

    const form      = document.getElementById('orderForm');
    const firstEl   = document.getElementById('buyerFirst');
    const lastEl    = document.getElementById('buyerLast');
    const emailEl   = document.getElementById('buyerEmail');
    const codeEl    = document.getElementById('buyerCode');

    const cart = new Map(); // key -> {p, size, qty}  (key = `${id}__${size}`)

    const renderGrid = () => {
      grid.innerHTML = PRODUCTS.map(p => {
        const imgs = (p.images || []).slice(0, 2).map((src, i) => `
          <img class="product__img" src="${src}" alt="${p.name} ${i === 0 ? 'Vorderseite' : 'R√ºckseite'}" loading="lazy" />
        `).join('');

        const inCart = [...cart.keys()].some(k => k.startsWith(p.id + "__"));

        return `
          <article class="product" data-id="${p.id}">
            <div class="product__imgs">${imgs}</div>
            <div class="product__body">
              <h3 class="product__name">${p.name}</h3>
              <p class="product__meta">${p.meta}</p>
              <div class="product__row" style="gap:10px; flex-wrap:wrap;">
                <select class="size-select" data-size-for="${p.id}" aria-label="Gr√∂√üe w√§hlen" required>
                  <option value="" selected disabled>Gr√∂√üe w√§hlen</option>
                  <option value="S">S</option>
                  <option value="M">M</option>
                  <option value="L">L</option>
                  <option value="XL">XL</option>
                  <option value="XXL">XXL</option>
                </select>
                <span class="pill">Preis: ${p.price}</span>
                <button class="btn ${inCart ? 'btn--added' : 'btn--primary'}" type="button" data-add="${p.id}">${inCart ? '‚úì Im Warenkorb' : '+ In den Warenkorb'}</button>
              </div>
            </div>
          </article>
        `;
      }).join('');
    };

    const renderCart = () => {
      const items = [...cart.entries()].map(([key, v]) => ({ key, ...v }));
      cartEmpty.style.display = items.length ? 'none' : 'block';
      cartList.innerHTML = items.map(({key, p, size, qty}) => `
        <li class="cart__item">
          <div>
            <strong>${p.name}</strong>
            <small>${p.price}${size ? ` ‚Ä¢ Gr√∂√üe: ${size}` : ''}${p.meta ? ` ‚Ä¢ ${p.meta}` : ''}</small>
          </div>
          <div style="display:flex; gap:8px; align-items:center;">
            <button class="btn btn--ghost" type="button" data-dec="${key}" aria-label="minus">‚àí</button>
            <strong>${qty}</strong>
            <button class="btn btn--ghost" type="button" data-inc="${key}" aria-label="plus">+</button>
          </div>
        </li>
      `).join('');
    };

    const add = (id, size) => {
      const p = PRODUCTS.find(x => x.id === id);
      if (!p) return;

      const chosen = (size || '').trim();
      if (!chosen) return;

      const key = `${id}__${chosen}`;
      const entry = cart.get(key);
      cart.set(key, { p, size: chosen, qty: (entry?.qty || 0) + 1 });
      renderCart();
      renderGrid();
    };

    const inc = (key) => {
      const entry = cart.get(key);
      if (!entry) return;
      cart.set(key, { ...entry, qty: entry.qty + 1 });
      renderCart();
      renderGrid();
    };

    const dec = (key) => {
      const entry = cart.get(key);
      if (!entry) return;
      const next = entry.qty - 1;
      if (next <= 0) cart.delete(key);
      else cart.set(key, { ...entry, qty: next });
      renderCart();
      renderGrid();
    };
    const buildOrder = () => {
      const items = [...cart.entries()].map(([key, v]) => ({ key, ...v }));
      if (!items.length) return null;

      const lines = [];
      items.forEach(({p, size, qty}) => {
        lines.push(`- ${qty}x ${p.name}${size ? ` (Gr√∂√üe: ${size})` : ''} ‚Äî ${p.price}`);
        if (p.meta) lines.push(`  Details: ${p.meta}`);
      });

      return {
        items,
        order_text: lines.join('\n'),
        order_items_json: JSON.stringify(items.map(({p, size, qty}) => ({
          id: p.id, name: p.name, size, meta: p.meta, price: p.price, qty
        })))
      };
    };

    renderGrid();
    renderCart();

    grid.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-add]');
      if (!btn) return;
      const id = btn.getAttribute('data-add');
      const card = btn.closest('.product');
      const sel = card ? card.querySelector(`[data-size-for="${id}"]`) : null;
      const size = sel ? sel.value : '';
      if (!size) {
        alert('Bitte zuerst eine Gr√∂√üe ausw√§hlen (S‚ÄìXXL).');
        if (sel) sel.focus();
        return;
      }
      add(id, size);
    });

    cartList.addEventListener('click', (e) => {
      const incBtn = e.target.closest('[data-inc]');
      const decBtn = e.target.closest('[data-dec]');
      if (incBtn) return inc(incBtn.getAttribute('data-inc'));
      if (decBtn) return dec(decBtn.getAttribute('data-dec'));
    });

    clearBtn.addEventListener('click', () => {
      cart.clear();
      renderCart();
      renderGrid();
    });

    // Send order via EmailJS
    sendBtn.addEventListener('click', async () => {
      const order = buildOrder();
      if (!order) {
        alert('Warenkorb ist leer.');
        return;
      }

      const buyer_first = (firstEl.value || '').trim();
      const buyer_last  = (lastEl.value || '').trim();
      const buyer_email = (emailEl.value || '').trim();
      const passcode    = (codeEl.value || '').trim();

      if (!buyer_first || !buyer_last || !buyer_email || !passcode) {
        alert('Bitte Vorname, Nachname, E‚ÄëMail und Passcode ausf√ºllen.');
        return;
      }

      // very simple email sanity check (browser validation should catch most)
      if (!/^\S+@\S+\.\S+$/.test(buyer_email)) {
        alert('Bitte eine g√ºltige E‚ÄëMail-Adresse eingeben.');
        emailEl.focus();
        return;
      }

      // passcode check (do NOT reveal hint)
      if (passcode !== 'fs') {
        alert('Passcode ist falsch.');
        codeEl.focus();
        codeEl.select();
        return;
      }

      sendBtn.disabled = true;
      sendBtn.textContent = 'Sende‚Ä¶';

      try {
        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
          buyer_first,
          buyer_last,
          buyer_email,
          order_text: order.order_text,
          order_items_json: order.order_items_json
        });

        alert('Bestellung wurde gesendet ‚úÖ');
        cart.clear();
        renderCart();
        form.reset();
      } catch (err) {
        console.error(err);
        alert('Senden fehlgeschlagen. Bitte sp√§ter nochmal versuchen.');
      } finally {
        sendBtn.disabled = false;
        sendBtn.textContent = 'Bestellung senden';
      }
    });
  })();
</script>

<script>
  // -------------------- Events / Kalender (FullCalendar) --------------------
  // üëâ Events bitte hier im Code pflegen:
  // Format: { title, start, end?, extendedProps: { place?, note? } }
  (function(){
    const calEl = document.getElementById('fsCalendar');
    if(!calEl || !window.FullCalendar) return;

    const FS_EVENTS = [
      {
        title: 'Training ‚Äì Rudeschule',
        start: '2026-02-24T20:00:00',
        end: '2026-02-24T22:00:00',
        extendedProps: { place: 'Flensburg', note: 'Bitte 10 min vorher da sein.' }
      },
      {
        title: 'Training ‚Äì Gemeinschaftsschule West',
        start: '2026-02-27T18:00:00',
        end: '2026-02-27T21:00:00',
        extendedProps: { place: 'Flensburg', note: 'Bitte 10 min vorher da sein.' }
      },
  
    ];

    function fmtDate(iso){
      try {
        return new Date(iso).toLocaleString('de-DE', { dateStyle:'medium', timeStyle:'short' });
      } catch(e){ return iso; }
    }

    function renderUpcoming(events){
      const listEl = document.getElementById('upcomingList');
      if(!listEl) return;
      const now = new Date();
      const upcoming = (events || [])
        .filter(ev => ev.start && new Date(ev.start) >= new Date(now.getTime() - 60*60*1000))
        .sort((a,b)=> new Date(a.start) - new Date(b.start))
        .slice(0, 10);

      if(upcoming.length === 0){
        listEl.innerHTML = '<div class="events-empty">Aktuell sind keine Termine eingetragen.</div>';
        return;
      }

      listEl.innerHTML = upcoming.map(ev => {
        const place = (ev.extendedProps && ev.extendedProps.place) ? ev.extendedProps.place : '';
        const note  = (ev.extendedProps && ev.extendedProps.note) ? ev.extendedProps.note : '';
        return `
          <div class="events-item">
            <div class="events-item__title">${ev.title || 'Event'}</div>
            <div class="events-item__meta">
              <span>${fmtDate(ev.start)}</span>${place ? ` ‚Ä¢ <span>${place}</span>` : ''}
            </div>
            ${note ? `<div class="events-item__note">${note}</div>` : ''}
          </div>
        `;
      }).join('');
    }

    const calendar = new FullCalendar.Calendar(calEl, {
      initialView: 'dayGridMonth',
      height: 'auto',
      locale: 'de',
      firstDay: 1,
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,listMonth'
      },
      events: FS_EVENTS,
      eventClick: function(info){
        const ev = info.event;
        const place = ev.extendedProps?.place ? `
Ort: ${ev.extendedProps.place}` : '';
        const note  = ev.extendedProps?.note  ? `
Notiz: ${ev.extendedProps.note}` : '';
        const end   = ev.end ? `
Ende: ${fmtDate(ev.end)}` : '';
        alert(`${ev.title}
Start: ${fmtDate(ev.start)}${end}${place}${note}`);
      }
    });

    calendar.render();
    renderUpcoming(FS_EVENTS);
  })();
</script>
</body>
</html>
